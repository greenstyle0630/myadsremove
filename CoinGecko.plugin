#!name=CoinGeckoå»å¹¿å‘Š(V3å®½æ³›ç‰ˆ)
#!desc=ä¿®å¤åŒ¹é…é—®é¢˜ï¼Œå¼ºåˆ¶è§£é”ä¼šå‘˜
#!author=LoonUser
#!icon=https://static.coingecko.com/s/coingecko-logo-8903d34ce19ca4be1c81f0db30e924154750d208683fad7ae6f2ce06c76d0a56.png
#!date=2026-01-14 14:30

[MitM]
hostname = mobile-api.coingecko.com, geckad.com

[Script]
# 1. æ‹¦æˆª geckad å¹¿å‘Š (ç›´æ¥å±è”½)
http-response ^https:\/\/geckad\.com\/kevel\/ad script-echo-response, body="{}"

# 2. ä¿®æ”¹ä¼šå‘˜çŠ¶æ€ (ä½¿ç”¨è¶…å®½æ³›åŒ¹é…ï¼Œåªè¦æ˜¯APIéƒ½æ£€æŸ¥)
http-response ^https:\/\/mobile-api\.coingecko\.com\/api\/v3\/ script-body=cg_vip_v3, requires-body=true

[Script-Body]
cg_vip_v3 = <<JS
// è·å–å½“å‰è¯·æ±‚çš„URLï¼Œåªå¤„ç† global æ¥å£
let url = $request.url;
if (url.indexOf("global") !== -1 || url.indexOf("user_settings") !== -1) {
    try {
        let obj = JSON.parse($response.body);

        // 1. å¼ºåˆ¶è¦†ç›– active_subscriptions
        // è¿™æ˜¯æœ€ç‹ çš„ä¸€æ‹›ï¼ŒApp çœ‹åˆ°è¿™ä¸ªæ•°ç»„æœ‰ä¸œè¥¿å°±ä¼šè®¤
        let fakeSub = {
            "id": "coingecko_premium_plus_yearly",
            "type": "subscription",
            "plan_name": "Premium+",
            "status": "active",
            "starts_at": 1704067200, 
            "ends_at": 4860009600,
            "currency": "usd",
            "amount": 99.99,
            "auto_renew": true
        };
        obj.active_subscriptions = [fakeSub];

        // 2. ä¿®æ”¹ subscription å¯¹è±¡
        if (!obj.subscription) obj.subscription = {};
        obj.subscription.subscription_plan_name = "Premium+";
        obj.subscription.plan_name = "Premium+"; // é˜²å¾¡æ€§å¤šå†™ä¸€ä¸ª
        obj.subscription.status = "active";
        
        // 3. å…³æ‰å¹¿å‘Šé…ç½®
        if (!obj.subscription.config) obj.subscription.config = {};
        obj.subscription.config.hide_ads = true;
        
        // 4. ä¿®æ”¹ç”¨æˆ·æ˜¾ç¤ºåç§° (å¯é€‰ï¼Œç”¨æ¥éªŒè¯è„šæœ¬æ˜¯å¦ç”Ÿæ•ˆ)
        // å¦‚æœä½ åœ¨Appé‡Œçœ‹åˆ°åå­—å˜äº†ï¼Œè¯´æ˜è„šæœ¬ç»å¯¹è¿è¡Œäº†
        if (obj.name) obj.name = "ğŸ’ Premium User ğŸ’";

        $done({body: JSON.stringify(obj)});
    } catch (e) {
        $done({});
    }
} else {
    // ä¸æ˜¯ global æ¥å£ï¼ŒåŸæ ·æ”¾è¡Œ
    $done({});
}
JS
